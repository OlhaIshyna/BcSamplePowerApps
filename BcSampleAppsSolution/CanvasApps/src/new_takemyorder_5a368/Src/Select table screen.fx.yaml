"'Select table screen' As screen":
    Fill: =varTheme.secondaryColor
    LoadingSpinnerColor: =RGBA(100, 118, 132, 1)
    OnVisible: |-
        =// Clear data
        Clear(colCachedSalesOrdersForTables);
        Clear(colSelectedItems);
        Clear(colOrderSummary);
        
        Set(varSelectedItemGroup, Blank());
        Set(varAddItemsToCurrentOrder, Blank());
        Set(varActiveorderForSelectedTable, Blank());
        
        // Load table data
        Select(icnUpdateTables)

    conSelecTableContent As groupContainer.verticalAutoLayoutContainer:
        Height: =Parent.Height
        LayoutDirection: =LayoutDirection.Vertical
        LayoutMode: =LayoutMode.Auto
        Width: =Parent.Width
        ZIndex: =5

        conSelectTableHeader As groupContainer.manualLayoutContainer:
            FillPortions: =0
            Height: =100
            LayoutMinHeight: =112
            LayoutMinWidth: =250
            ZIndex: =1

            lblSelectTableHeader As label:
                Align: =Align.Center
                BorderColor: =RGBA(32, 54, 71, 1)
                Color: =RGBA(0, 0, 0, 1)
                DisabledColor: =RGBA(166, 166, 166, 1)
                Font: =varTheme.font
                Height: =91
                Size: =30
                Text: ="Select table"
                Width: =Parent.Width
                X: =Parent.Width/2 - Self.Width/2
                ZIndex: =1

            icnUpdateTables As icon.Add:
                BorderColor: =RGBA(32, 54, 71, 1)
                Color: =RGBA(32, 54, 71, 1)
                DisabledBorderColor: =RGBA(166, 166, 166, 1)
                DisabledColor: =RGBA(244, 244, 244, 1)
                Height: =100
                Icon: =Icon.Reload
                OnSelect: |
                    =UpdateContext({ctxShowLoading: true});
                    
                    // Ensure sales orders inlcude latest changes
                    Refresh('salesOrders (v2.0)');
                    
                    // Cache sales orders to avoid calling connector in ForAll and only load needed columns
                    UpdateContext({ctxCachedSalesOrders: ShowColumns('salesOrders (v2.0)', "customerId", "number")});
                    
                    Clear(colTempTableStatus);
                    ForAll(varTables As table, 
                        // Only load the sales orders we need in the collection we lookup
                        Collect(colCachedSalesOrdersForTables, LookUp(ctxCachedSalesOrders, customerId = table.id));
                        Collect(colTempTableStatus, {
                            id: table.id,
                            displayName: table.displayName,
                            free: IsBlank(LookUp(colCachedSalesOrdersForTables, customerId = table.id)),
                            orderNumber: LookUp(colCachedSalesOrdersForTables, customerId = table.id).number,
                            customerId: LookUp(colCachedSalesOrdersForTables, customerId = table.id).customerId    
                        });
                    ); 
                    
                    ClearCollect(colTableStatus, colTempTableStatus);
                    
                    // Clear temporary variables
                    Clear(colTempTableStatus);
                    Clear(colCachedSalesOrdersForTables);
                    UpdateContext({ctxShowLoading: false, ctxCachedSalesOrders: Blank()});
                PaddingBottom: =30
                PaddingLeft: =30
                PaddingRight: =30
                PaddingTop: =30
                Width: =100
                X: =Parent.Width - Self.Width
                ZIndex: =2

        comDividerSelectTable As comBigDivider:
            Height: =16
            LayoutMinHeight: =640
            Width: =Parent.Width
            Y: =lblSelectTableHeader.Y + lblSelectTableHeader.Height
            ZIndex: =3

        "galTables As gallery.'BrowseLayout_Vertical_ThreeTextVariant_ver4.0'":
            BorderColor: =RGBA(32, 54, 71, 1)
            Height: =979
            Items: =colTableStatus
            Layout: =Layout.Vertical
            LayoutMinHeight: =287
            LayoutMinWidth: =320
            LoadingSpinner: =LoadingSpinner.Controls
            OnSelect: |+
                =Clear(colSelectedItems);
                Set(varSelectedTable, ThisItem);
                
                If(varSelectedTable.free,
                    Set(varActiveorderForSelectedTable, Blank());
                    Navigate('Select Items Screen', ScreenTransition.Cover);
                    ,
                    Set(varActiveorderForSelectedTable, LookUp('salesOrders (v2.0)',number = varSelectedTable.orderNumber));
                    Navigate('Order Summary Screen', ScreenTransition.Cover, {ctxCallingPage: 'Select table screen'});    
                );
                
            ShowNavigation: =true
            TemplatePadding: =0
            TemplateSize: =120
            Y: =
            ZIndex: =4

            recTableGallerySeperator As rectangle:
                BorderColor: =RGBA(32, 54, 71, 1)
                Fill: =Color.DarkGray
                Height: =2
                OnSelect: =Select(Parent)
                Width: =Parent.TemplateWidth - 40
                X: =20
                Y: =118
                ZIndex: =5

            lblTableStatus As label:
                BorderColor: =RGBA(32, 54, 71, 1)
                Color: =RGBA(0, 0, 0, 1)
                DisabledColor: =RGBA(166, 166, 166, 1)
                Font: =varTheme.font
                Height: =lblTableName.Height
                OnSelect: =Select(Parent)
                Size: =21
                Text: =If(ThisItem.free, "Free", "Order placed")
                Width: =lblTableName.Width
                X: =lblTableName.X
                Y: =lblTableName.Height
                ZIndex: =7

            lblTableName As label:
                BorderColor: =RGBA(32, 54, 71, 1)
                Color: =RGBA(0, 0, 0, 1)
                DisabledColor: =RGBA(166, 166, 166, 1)
                Font: =varTheme.font
                FontWeight: =FontWeight.Semibold
                Height: =50
                OnSelect: =Select(Parent)
                Size: =21
                Text: =ThisItem.displayName
                Width: =Parent.TemplateWidth - 160
                X: =figStatusCircle.X + figStatusCircle.Width + 20
                Y: =10
                ZIndex: =8

            figStatusCircle As circle:
                BorderColor: =RGBA(32, 54, 71, 1)
                Fill: =If(ThisItem.free, Color.DarkGray, varTheme.primaryColor)
                Height: =60
                OnSelect: =Select(Parent)
                Width: =60
                X: =30 
                Y: =Parent.TemplateHeight/2 - Self.Height/2
                ZIndex: =10

            icnStatusPeople As icon.People:
                BorderColor: =RGBA(32, 54, 71, 1)
                Color: =Color.White
                DisabledBorderColor: =RGBA(166, 166, 166, 1)
                DisabledColor: =RGBA(244, 244, 244, 1)
                Height: =40
                Icon: =Icon.People
                Visible: =Not(ThisItem.free)
                Width: =40
                X: =figStatusCircle.X + figStatusCircle.Width/2 - Self.Width/2
                Y: =figStatusCircle.Y + figStatusCircle.Height/2 - Self.Height/2
                ZIndex: =11

            icnSelectTable As icon.ChevronRight:
                BorderColor: =RGBA(32, 54, 71, 1)
                Color: =varTheme.primaryColor
                DisabledBorderColor: =RGBA(166, 166, 166, 1)
                DisabledColor: =RGBA(244, 244, 244, 1)
                Height: =30
                Icon: =Icon.ChevronRight
                OnSelect: =Select(Parent)
                Width: =30
                X: =Parent.Width - Self.Width - 30
                Y: =Parent.TemplateHeight/2 - Self.Height/2
                ZIndex: =12

    comLoadingOverlayTables As comLoadingOverlay:
        Fill: =RGBA(0, 0, 0, 0)
        Height: =galTables.Height
        Visible: =ctxShowLoading
        Y: =galTables.Y
        ZIndex: =6

